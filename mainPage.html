<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Advanced Smart Greenhouse CPS</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      body {
        font-family: "Segoe UI", Arial, sans-serif;
        margin: 0;
        padding: 0;
        background: linear-gradient(135deg, #e0f7fa, #e8f5e9);
      }
      nav {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 40px;
        background: rgba(38, 166, 154, 0.9);
        color: #fff;
        position: sticky;
        top: 0;
        z-index: 100;
        box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2);
      }
      nav h2 {
        margin: 0;
        font-size: 22px;
      }
      nav a {
        color: #fff;
        text-decoration: none;
        margin-left: 25px;
        font-weight: bold;
        transition: 0.3s;
      }
      nav a:hover {
        color: #b2dfdb;
      }
      .container {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        padding: 20px 40px;
        justify-content: center;
      }
      .card {
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(8px);
        border-radius: 20px;
        padding: 25px;
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        flex: 1;
        min-width: 320px;
        transition: transform 0.3s, box-shadow 0.3s;
      }
      .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 12px 25px rgba(0, 0, 0, 0.25);
      }
      .controls label {
        display: block;
        margin-top: 15px;
        font-weight: bold;
        color: #00796b;
      }
      .controls input {
        width: 100%;
        padding: 10px;
        margin-top: 6px;
        border-radius: 8px;
        border: 1px solid #ccc;
        font-size: 16px;
      }
      .controls button {
        margin-top: 20px;
        width: 100%;
        padding: 12px;
        font-size: 16px;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        background: #26a69a;
        color: white;
        transition: all 0.3s;
      }
      .controls button:hover {
        background: #00897b;
        transform: translateY(-2px);
      }
      .status-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
        margin-bottom: 15px;
      }
      .actuator {
        font-size: 16px;
        padding: 12px;
        border-radius: 10px;
        text-align: center;
        font-weight: bold;
        transition: all 0.3s;
        cursor: default;
        position: relative;
      }
      .actuator.off {
        background: #c8e6c9;
        color: #2e7d32;
      }
      .actuator.on {
        background: #ef5350;
        color: #fff;
      }
      .values {
        margin: 10px 0;
        padding: 12px;
        background: #b2dfdb;
        border-radius: 10px;
        font-size: 16px;
        font-weight: bold;
        text-align: center;
        transition: all 0.5s ease;
      }
      .logic {
        margin-top: 20px;
        background: #f1f8e9;
        padding: 12px;
        border-radius: 10px;
        font-size: 14px;
      }
      canvas {
        margin-top: 15px;
      }
      #logs {
        max-height: 200px;
        overflow-y: auto;
        padding: 10px;
        background: #e0f2f1;
        border-radius: 10px;
        font-size: 14px;
        margin-top: 15px;
      }
      @media (max-width: 900px) {
        .container {
          flex-direction: column;
          align-items: center;
        }
      }
    </style>
  </head>
  <body>
    <nav>
      <h2>Smart Greenhouse CPS</h2>
      <div><a href="./index.html">Home</a></div>
    </nav>

    <div class="container">
      <div class="card controls">
        <h3>Setpoints</h3>
        <label>Temperature Setpoint (°C)</label>
        <input type="number" id="tempSet" value="24" />
        <label>Humidity Setpoint (%)</label>
        <input type="number" id="humSet" value="55" />
        <label>Light Setpoint (Lux)</label>
        <input type="number" id="lightSet" value="400" />
        <button onclick="startSim()">Start Simulation</button>
        <button onclick="stopSim()">Stop Simulation</button>
      </div>

      <div class="card status">
        <h3>System Status</h3>
        <div class="values" id="currentValues">
          Temperature: <span id="tempVal">22</span> °C | Humidity:
          <span id="humVal">50</span>% | Light:
          <span id="lightVal">300</span> Lux
        </div>
        <div class="status-grid">
          <div class="actuator off" id="fan" title="Fan cools the greenhouse">
            Fan: OFF <i class="fas fa-fan"></i>
          </div>
          <div
            class="actuator off"
            id="heater"
            title="Heater warms the greenhouse"
          >
            Heater: OFF <i class="fas fa-fire"></i>
          </div>
          <div
            class="actuator off"
            id="sprinkler"
            title="Sprinkler increases humidity"
          >
            Sprinkler: OFF <i class="fas fa-tint"></i>
          </div>
          <div
            class="actuator off"
            id="light"
            title="Grow Light provides light"
          >
            Grow Light: OFF <i class="fas fa-lightbulb"></i>
          </div>
        </div>

        <canvas id="lineChart" height="200"></canvas>
        <canvas id="pieChart" height="200" style="margin-top: 25px"></canvas>
        <div class="logic">
          <strong>CPS Decision Logic:</strong>
          <ul>
            <li>If Temperature &gt; Setpoint + 0.5 → Fan ON</li>
            <li>If Temperature &lt; Setpoint − 0.5 → Heater ON</li>
            <li>If Humidity &lt; Setpoint − 2 → Sprinkler ON</li>
            <li>If Light &lt; Setpoint − 50 → Grow Light ON</li>
          </ul>
        </div>
        <div id="logs"></div>
      </div>
    </div>

    <script>
      let temperature = 22,
        humidity = 50,
        light = 300,
        tick = 0,
        running = false,
        interval;
      let actuatorTime = { fan: 0, heater: 0, sprinkler: 0, light: 0 };
      const lineCtx = document.getElementById("lineChart").getContext("2d");
      const pieCtx = document.getElementById("pieChart").getContext("2d");

      const lineChart = new Chart(lineCtx, {
        type: "line",
        data: {
          labels: [],
          datasets: [
            {
              label: "Temperature (°C)",
              data: [],
              borderColor: "red",
              fill: false,
            },
            {
              label: "Humidity (%)",
              data: [],
              borderColor: "blue",
              fill: false,
            },
            {
              label: "Light (Lux)",
              data: [],
              borderColor: "orange",
              fill: false,
            },
          ],
        },
        options: { animation: false, scales: { y: { beginAtZero: true } } },
      });

      const pieChart = new Chart(pieCtx, {
        type: "pie",
        data: {
          labels: ["Fan", "Heater", "Sprinkler", "Light"],
          datasets: [
            {
              data: [0, 0, 0, 0],
              backgroundColor: ["#ef5350", "#ff9800", "#42a5f5", "#26a69a"],
            },
          ],
        },
        options: {
          responsive: true,
          plugins: { legend: { position: "bottom" } },
        },
      });

      function startSim() {
        if (running) return;
        running = true;
        interval = setInterval(simulate, 500);
      }
      function stopSim() {
        running = false;
        clearInterval(interval);
      }

      function simulate() {
        const tempSet = parseFloat(document.getElementById("tempSet").value);
        const humSet = parseFloat(document.getElementById("humSet").value);
        const lightSet = parseFloat(document.getElementById("lightSet").value);

        temperature += Math.random() - 0.5;
        humidity += Math.random() * 4 - 2;
        light += Math.random() * 40 - 20;

        document.getElementById("tempVal").innerText = temperature.toFixed(1);
        document.getElementById("humVal").innerText = humidity.toFixed(1);
        document.getElementById("lightVal").innerText = light.toFixed(0);

        updateActuator("fan", temperature > tempSet + 0.5);
        updateActuator("heater", temperature < tempSet - 0.5);
        updateActuator("sprinkler", humidity < humSet - 2);
        updateActuator("light", light < lightSet - 50);

        tick++;
        lineChart.data.labels.push(tick);
        lineChart.data.datasets[0].data.push(temperature);
        lineChart.data.datasets[1].data.push(humidity);
        lineChart.data.datasets[2].data.push(light);

        if (lineChart.data.labels.length > 50) {
          lineChart.data.labels.shift();
          lineChart.data.datasets.forEach((d) => d.data.shift());
        }
        lineChart.update();

        pieChart.data.datasets[0].data = [
          actuatorTime.fan,
          actuatorTime.heater,
          actuatorTime.sprinkler,
          actuatorTime.light,
        ];
        pieChart.update();
      }

      function updateActuator(id, state) {
        const el = document.getElementById(id);
        el.innerHTML =
          `${id.charAt(0).toUpperCase() + id.slice(1)}: ${
            state ? "ON" : "OFF"
          } ` + el.querySelector("i").outerHTML;
        el.className = "actuator " + (state ? "on" : "off");
        actuatorTime[id] += state ? 0.5 : 0;

        logEvent(id, state);
      }

      function logEvent(id, state) {
        const logs = document.getElementById("logs");
        logs.innerHTML =
          `[Tick ${tick}] ${id.charAt(0).toUpperCase() + id.slice(1)} turned ${
            state ? "ON" : "OFF"
          }<br>` + logs.innerHTML;
        if (logs.children.length > 10) {
          logs.removeChild(logs.lastChild);
        }
      }
    </script>
  </body>
</html>
